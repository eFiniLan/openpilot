From e8bb9eb15bf64ace73fce615aea7187381424938 Mon Sep 17 00:00:00 2001
From: Jacob Pfeifer <jacob@pfeifer.dev>
Date: Sat, 29 Jul 2023 18:11:30 -0400
Subject: [PATCH] Always On Lateral

Provides support for Always On Lateral on some cars. Note that always on
lateral requires changes to panda safety code so please refer to the
corresponding panda commit to read and understand those changes. To
engage lateral you must have engaged cruise control at least once after
pressing the main button. Once cruise control has been engaged lateral
will remain on after a brake press or the cancel button has been
pressed. Pressing the cruise main button again will disable lateral
control.
---
 selfdrive/controls/always_on_lateral.py | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/selfdrive/controls/always_on_lateral.py b/selfdrive/controls/always_on_lateral.py
index 69d5ba546..a0c7d119c 100644
--- a/selfdrive/controls/always_on_lateral.py
+++ b/selfdrive/controls/always_on_lateral.py
@@ -151,7 +151,7 @@ class AlwaysOnLateral:
     self.standstill = car_state.vEgo <= max(car_params.minSteerSpeed, MIN_LATERAL_CONTROL_SPEED) or car_state.standstill
     self.steer_fault = car_state.steerFaultTemporary or car_state.steerFaultPermanent
     self.invalid_gear = car_state.gearShifter not in [car.CarState.GearShifter.drive, car.CarState.GearShifter.sport, car.CarState.GearShifter.low, car.CarState.GearShifter.eco]
-    self.calibrated = self.sm['liveCalibration'].calStatus == log.LiveCalibrationData.Status.calibrated
+    self.calibrated = sm['liveCalibration'].calStatus == log.LiveCalibrationData.Status.calibrated
 
     # Always allow lateral when controls are allowed
     if any(ps.controlsAllowed for ps in panda_states) and not lateral_allowed:
-- 
2.41.0

